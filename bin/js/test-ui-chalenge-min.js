var API_HOST="freegeoip.net";angular.module("dataSeverProvider",[]).factory("serverDataProvider",["$http",function($http){searchObject=function(model,callback){$http({method:"GET",url:"http://"+API_HOST+"/json/"+model}).then(function(response){callback(response.data,!0)}).catch(function(response){console.log(response.status),callback(response,!1)})},getMyLocation=function(callback){$http({type:"GET",url:"http://"+API_HOST+"/json/"}).then(function(response){callback(response.data,!0)}).catch(function(response){callback(response,!1)})};return{searchObject:searchObject,getMyLocation:getMyLocation,myLatitude:"",myLogintude:""}}]);var startApp=angular.module("startApp",["ngRoute","dataSeverProvider","ngSanitize"]);startApp.config(function($routeProvider){$routeProvider.when("/:latitude/:longitude",{templateUrl:"./view/html/showLocate.html",controller:"iframeMapsController"}).when("/",{templateUrl:"./view/html/form.html",controller:"formSearch"}).otherwise({redirectTo:"/"})}),startApp.controller("formSearch",["$scope","serverDataProvider",function($scope,serverDataProvider){$scope.showError=!1,$scope.searchLocale=function(){console.log($scope.url),$scope.showError=!1;var url=$scope.url.replace(/(^\w+:|^)\/\//g,"");url.match(/(^[www]+\.)/g)||(url="www."+url),serverDataProvider.searchObject(url,function(data,status){1==status?($scope.error="",window.location="http://localhost:5000/#!/"+data.latitude+"/"+data.longitude):($scope.error="Invalid URL",$scope.showError=!0)})}}]);var map,marker;startApp.controller("iframeMapsController",["$scope","$routeParams","serverDataProvider","$rootScope",function($scope,$routeParams,serverDataProvider,$rootScope){$rootScope.$on("setMap",function(event,args){document.getElementById("showMap")&&(document.getElementById("showMap").innerHTML="",""!=serverDataProvider.myLatitude&&""!=serverDataProvider.myLogintude?getDistance():getPositionServer())});var getDistance=function(){var directionsService=new google.maps.DirectionsService;console.log("getDistance"),directionsDisplay=new google.maps.DirectionsRenderer;var myOptions={mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("showMap"),myOptions),directionsDisplay.setMap(map);var request={origin:serverDataProvider.myLatitude+", "+serverDataProvider.myLogintude,destination:$routeParams.latitude+", "+$routeParams.longitude,travelMode:google.maps.DirectionsTravelMode.WALKING};directionsService.route(request,function(response,status){status==google.maps.DirectionsStatus.OK&&directionsDisplay.setDirections(response)})},getPositionServer=function(){var mapProp={center:new google.maps.LatLng($routeParams.latitude,$routeParams.longitude),zoom:10};map=new google.maps.Map(document.getElementById("showMap"),mapProp),marker=new google.maps.Marker({position:{lat:Number($routeParams.latitude),lng:Number($routeParams.longitude)},map:map})};""!=serverDataProvider.myLatitude&&""!=serverDataProvider.myLogintude?getDistance():getPositionServer()}]),startApp.controller("geoLocation",["serverDataProvider","$scope","$rootScope",function(serverDataProvider,$scope,$rootScope){function updateLocationDetails(data){var now=new Date;$scope.query=data.ip,$scope.country=data.country_name,$scope.regionName=data.region_name,$scope.city=data.city,$scope.zip_code=data.zip_code,$scope.lat=data.latitude,$scope.lon=data.longitude,serverDataProvider.myLatitude=data.latitude,serverDataProvider.myLogintude=data.longitude,angular.element("table").removeClass("empty"),angular.element(".help").click(function(e){var fieldName=angular.element(e.currentTarget).closest("tr").find(".field_name").text();alert("This is your "+fieldName+" according to "+API_HOST+" at "+now)}),$rootScope.$broadcast("setMap")}$scope.initializePage=function(){$scope.query=" ",$scope.country=" ",$scope.regionName=" ",$scope.city=" ",$scope.zip_code=" ",$scope.lat=" ",$scope.lon=" "},$scope.resetLocationDetails=function(){updateLocationDetails({ip:"0.0.0.0",country_name:"",region_name:"",city:"",zip_code:"",latitude:"",longitude:""}),angular.element("table").addClass("empty")},$scope.initializePage(),$scope.getMyLocation=function(){serverDataProvider.getMyLocation(function(data,response){1==response?updateLocationDetails(data):console.log("Error")})}}]);